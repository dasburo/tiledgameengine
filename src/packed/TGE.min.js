/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(e){var a=void 0,c=!1;function f(){this.a=a;this.debug=c}var g=a,h=0,j=0,k=0,l=c,m=c,n={},p=c;f.prototype.init=function(){l||(l=!0,this.frame=this.frame.bind(this),f.bus=new f.PubSub,f.bus.subscribe("invalidateStage",this.b.bind(this)),this.f=g)};f.prototype.b=function(b,d){this.a&&this.a.name===d&&(p=!0)};f.prototype.start=function(){l&&(m||(h=e.requestAnimationFrame(this.frame)),m=!0)};f.prototype.stop=function(){m&&h&&e.cancelAnimationFrame(h);h=0;m=c;this.a&&(this.a.deactivate(),this.a=a)};
f.prototype.frame=function(b){g&&g.tickStart();var d=~~(b-k);if(!(0<j-d)||p)k=b,j=this.d(d,b),this.c();h=e.requestAnimationFrame(this.frame);g&&g.tick()};f.prototype.d=function(b,d){return this.a?this.a.update(b,~~d):~~(1E3/60)};f.prototype.c=function(){this.a&&(this.a.redraw||p)&&this.a.render();p=c};f.prototype.addStage=function(b,d){return!n[b]?(n[b]=d,!0):c};f.prototype.getStage=function(b){return!n[b]?a:n[b]};
f.prototype.activateStage=function(b){this.a&&(this.a.deactivate(),this.a=a);g&&g.e();n[b]&&(this.a=n[b],this.a.activate(),this.a.redraw=!0);g&&(g=new FPSMeter(document.getElementById("viewport"),{graph:1,heat:1,theme:"transparent"}));return this.a!==a};f.bus=a;e.TiledGameEngine=f})(window);
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(){
window.throttle=function(a,b,c){b||(b=250);var d,e;return function(){var n=c||this,g=+new Date,p=arguments;d&&g<d+b?(clearTimeout(e),e=setTimeout(function(){d=g;a.apply(n,p)},b)):(d=g,a.apply(n,p))}};for(var f=0,h=["ms","moz","webkit","o"],j=0;j<h.length&&!window.requestAnimationFrame;++j)window.requestAnimationFrame=window[h[j]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[h[j]+"CancelAnimationFrame"]||window[h[j]+"CancelRequestAnimationFrame"];
window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(0,25-(b-f)),d=window.setTimeout(function(){a(b+c)},c);f=b+c;return d});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var k=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;
k&&k.lineTo&&(k.dashedLine=function(a,b,c,d,e){e||(e=new Uint8Array([4,2]));var n=e.length;this.moveTo(a,b);c-=a;var g=d-b;d=c?g/c:1E15;for(var g=Math.sqrt(c*c+g*g),p=0,t=!0;0.1<=g;){var m=e[p++%n];m>g&&(m=g);var r=Math.sqrt(m*m/(1+d*d));0>c&&(r=-r);a+=r;b+=d*r;this[t?"lineTo":"moveTo"](a,b);g-=m;t=!t}return this});
k&&!k.roundRect&&(k.roundRect=function(a,b,c,d,e){c<2*e&&(e=c/2);d<2*e&&(e=d/2);this.beginPath();this.moveTo(a+e,b);this.arcTo(a+c,b,a+c,b+d,e);this.arcTo(a+c,b+d,a,b+d,e);this.arcTo(a,b+d,a,b,e);this.arcTo(a,b,a+c,b,e);this.closePath();return this});var l=document;function q(a,b){var c=l.createEvent("Event");c.initEvent(a,!0,!1);b.dispatchEvent(c)}function s(a){l[u.enabled]=l[v.enabled];l[u.element]=l[v.element];q(u.a.b,a.target)}function w(a){q(u.a.error,a.target)}
var v,x,y={e:{enabled:"fullscreenEnabled",element:"fullscreenElement",d:"requestFullscreen",c:"exitFullscreen",a:{b:"fullscreenchange",error:"fullscreenerror"}},h:{enabled:"webkitIsFullScreen",element:"webkitCurrentFullScreenElement",d:"webkitRequestFullScreen",c:"webkitCancelFullScreen",a:{b:"webkitfullscreenchange",error:"webkitfullscreenerror"}},f:{enabled:"mozFullScreen",element:"mozFullScreenElement",d:"mozRequestFullScreen",c:"mozCancelFullScreen",a:{b:"mozfullscreenchange",error:"mozfullscreenerror"}},
g:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",d:"msRequestFullscreen",c:"msExitFullscreen",a:{b:"MSFullscreenChange",error:"MSFullscreenError"}}},u=y.e;for(x in y)if(y[x].enabled in l){v=y[x];break}!(u.enabled in l)&&v&&(l.addEventListener(v.a.b,s,!1),l.addEventListener(v.a.error,w,!1),l[u.enabled]=l[v.enabled],l[u.element]=l[v.element],l[u.c]=l[v.c],Element.prototype[u.d]=function(){return this[v.d].apply(this,arguments)})})();
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function() {var a=navigator;TiledGameEngine.Device=new function(){this.Android=a.userAgent.match(/Android/i);this.BlackBerry=a.userAgent.match(/BlackBerry/i);this.iOS=a.userAgent.match(/iPhone|iPad|iPod/i);this.Opera=a.userAgent.match(/Opera Mini/i);this.Windows=a.userAgent.match(/IEMobile/i);this.mobile=this.Android||this.BlackBerry||this.iOS||this.Opera||this.Windows}})();
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(a){function f(c,d,e){this.active=!1;this.name=c;this.redraw=!1;this.am=d;this.screen=e;this.sidResize=this.sidMove=-1}f.prototype.update=function(){return this.active?(this.redraw=!0,16):1E3};f.prototype.render=function(){this.active&&(this.screen&&this.redraw)&&(this.redraw=!1)};f.prototype.onViewportResize=function(){this.redraw=!0;TiledGameEngine.bus.notify("invalidateStage",this.name)};
f.prototype.onViewportMove=function(){this.redraw=!0;TiledGameEngine.bus.notify("invalidateStage",this.name)};f.prototype.deactivate=function(){this.active=!1;TiledGameEngine.bus.unsubscribe("onViewportResize",this.sidResize);TiledGameEngine.bus.unsubscribe("onViewportMove",this.sidMove);this.sidResize=this.sidMove=-1;this.redraw=!1};
f.prototype.activate=function(){this.active=!0;this.sidResize=TiledGameEngine.bus.subscribe("onViewportResize",this.onViewportResize.bind(this));this.sidMove=TiledGameEngine.bus.subscribe("onViewportMove",this.onViewportMove.bind(this));this.redraw=!0;TiledGameEngine.bus.notify("invalidateStage",this.name)};f.prototype.offScreenRender=function(c,d,e){var b=document.createElement("canvas");b.width=c;b.height=d;e(b.getContext("2d"));return b};a.Stage=f})(TiledGameEngine);
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(h,j){var d=void 0;function k(){this.c=this.f=0;this.d={};this.b=[];this.k={};this.e=this.a=d;this.j=this.j.bind(this);this.g=this.g.bind(this);this.i=this.i.bind(this)}k.prototype.j=function(a){a.lengthComputable?a.loaded!==a.total&&this.a&&this.a(a.target.url,~~(100*(a.loaded/a.total))):this.a&&this.a(a.target.url,-1)};k.prototype.g=function(){++this.c;this.completed()&&this.h()};
k.prototype.l=function(a,b){var e=new Blob([a],{type:b}),c=new Image;c.onload=function(){h.URL.revokeObjectURL(c.src)};c.src=h.URL.createObjectURL(e);return c};k.prototype.m=function(a){a=new Uint8Array(a);for(var b=a.length,e="",c=0;c<b;c+=65535){var f=65535;c+65535>b&&(f=b-c);e+=String.fromCharCode.apply(null,a.subarray(c,c+f))}return JSON.parse(e)};
k.prototype.i=function(a){a=a.target;if(404!==a.status){var b=a.getResponseHeader("content-type");-1!==b.indexOf("image")?(b=this.l(a.response,b),this.f++):-1!==b.indexOf("json")?(b=this.m(a.response),this.f++):(console.warn("Unknown asset type",b),b=a.response,++this.c);this.d[a.url]=b}else++this.c,console.warn("Asset not found (404)",a.url);this.a&&this.a(a.url,100);this.completed()&&this.h()};k.prototype.h=function(){var a=this.e;this.e=this.a=d;this.b.length=0;a&&a()};
k.prototype.request=function(a){this.k[a]||(this.b[this.b.length]=a,this.k[a]=1)};k.prototype.download=function(a,b){if(0===this.b.length)a&&a();else{this.e=a;this.a=b;for(var e=0,c=this.b.length;e<c;++e){var f=this.b[e];if(this.d[f]){if(this.a&&this.a(f,100),this.completed()){this.h();break}}else{var g=new XMLHttpRequest;g.open("GET",f,!0);g.responseType="arraybuffer";g.url=f;g.onprogress=this.j;g.onerror=this.g;g.onload=this.i;g.send()}}}};k.prototype.get=function(a){return this.d[a]};
k.prototype.clear=function(){this.c=this.f=0;this.d={};this.b.length=0;this.k={};this.e=this.a=d};k.prototype.completed=function(){return this.b.length<=this.c+this.f};k.prototype.total=function(){return this.b.length};j.Assets=k;})(window,TiledGameEngine);
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(c){function e(){this.a={}}e.prototype.subscribe=function(a,b){a=a.toLowerCase();void 0===this.a[a]&&(this.a[a]=[]);this.a[a].push(b);return this.a[a].length-1};e.prototype.unsubscribe=function(a,b){a=a.toLowerCase();this.a[a]&&~b&&(this.a[a].splice(b,1),this.a[a].length||delete this.a[a])};e.prototype.notify=function(a,b){a=a.toLowerCase();if(this.a[a])for(var d=this.a[a].length;d--;)if(b)this.a[a][d](a,b);else this.a[a][d](a)};c.PubSub=e})(TiledGameEngine);
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(e) { var d=!0;function f(a,b,c){a||(a="#viewport");c||(c=320);b||(b=200);this.b=[];this.c=void 0;this.d=new Int32Array([-b,-c,b,c]);this.viewport=new Int32Array([0,0,b,c,!1]);this.a=new Int32Array([0,0,0,0,0]);this.layers=0;this.k=window.innerWidth-b;this.j=window.innerHeight-c;this.c=document.querySelector(a);this.c.style.cssText="position:fixed; left: 0px; top:0px; display:none;";this.offsetY=this.offsetX=0;window.addEventListener("resize",throttle(this.i,64,this),d);this.c.addEventListener("mousedown",throttle(this.g,
16,this),d);this.c.addEventListener("mouseup",throttle(this.e,16,this),d);this.c.addEventListener("mousemove",throttle(this.h,64,this),d);this.c.addEventListener("mouseout",throttle(this.e,16,this),d);document.addEventListener("keydown",this.f.bind(this),d);this.addLayer(2);setTimeout(function(){var a=this.c.getClientRects();a.length&&(this.offsetX=a[0].left,this.offsetY=a[0].top)}.bind(this),0)}
f.prototype.f=function(a){switch(a.which){case 33:this.a[3]=-8;this.a[4]=0;break;case 34:this.a[3]=8;this.a[4]=0;break;case 35:this.a[3]=0;this.a[4]=8;break;case 36:this.a[3]=0;this.a[4]=-8;break;case 37:this.a[3]=-2;this.a[4]=0;break;case 38:case 104:this.a[4]=-2;this.a[3]=0;break;case 39:this.a[3]=2;this.a[4]=0;break;case 40:this.a[4]=2;this.a[3]=0;break;case 97:this.a[4]=2;this.a[3]=-2;break;case 99:this.a[4]=2;this.a[3]=2;break;case 105:this.a[4]=-2;this.a[3]=2;break;case 103:this.a[4]=-2;this.a[3]=
-2;break;default:return}this.viewport[0]+this.a[3]>=this.d[0]&&this.viewport[0]+this.viewport[2]+this.a[3]<=this.d[2]?this.viewport[0]+=this.a[3]:this.a[3]=0;this.viewport[1]+this.a[4]>=this.d[1]&&this.viewport[1]+this.viewport[3]+this.a[4]<=this.d[3]?this.viewport[1]+=this.a[4]:this.a[4]=0;(this.a[3]||this.a[4])&&e.bus.notify("onviewportmove")};
f.prototype.g=function(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();this.a[0]=a.clientX-this.offsetX;this.a[1]=a.clientY-this.offsetY;this.a[2]=d};
f.prototype.e=function(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();if(this.a[2]&&(this.a[2]=!1,this.a[3]=a.clientX-this.a[0]-this.offsetX,this.a[4]=a.clientY-this.a[1]-this.offsetY,this.a[3]||this.a[4]))this.viewport[0]+this.a[3]>=this.d[0]&&this.viewport[0]+this.viewport[2]+this.a[3]<=this.d[2]?this.viewport[0]+=this.a[3]:this.a[3]=0,this.viewport[1]+this.a[4]>=this.d[1]&&this.viewport[1]+this.viewport[3]+this.a[4]<=this.d[3]?this.viewport[1]+=this.a[4]:this.a[4]=0,(this.a[3]||
this.a[4])&&e.bus.notify("onviewportmove")};
f.prototype.h=function(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();this.a[3]=a.clientX-this.a[0]-this.offsetX;this.a[4]=a.clientY-this.a[1]-this.offsetY;if(this.a[3]||this.a[4])this.a[2]?(this.viewport[0]+this.a[3]>=this.d[0]&&this.viewport[0]+this.viewport[2]+this.a[3]<=this.d[2]?this.viewport[0]+=this.a[3]:this.a[3]=0,this.viewport[1]+this.a[4]>=this.d[1]&&this.viewport[1]+this.viewport[3]+this.a[4]<=this.d[3]?this.viewport[1]+=this.a[4]:this.a[4]=0,(this.a[3]||this.a[4])&&
e.bus.notify("onviewportmove")):e.bus.notify("mousemove",{x:a.clientX-this.offsetX,y:a.clientY-this.offsetY}),this.a[0]=a.clientX-this.offsetX,this.a[1]=a.clientY-this.offsetY};f.prototype.i=function(a){document.fullscreenEnabled?(this.resize(a.target.innerWidth,a.target.innerHeight),this.offsetX=this.offsetY=0):(this.resize(a.target.innerWidth,a.target.innerHeight),a=this.c.getClientRects(),this.offsetX=a[0].left,this.offsetY=a[0].top)};
f.prototype.resize=function(a,b){for(var c=this.b.length;c--;)this.b[c].canvas.width=this.b[c].width=a,this.b[c].canvas.height=this.b[c].height=b;this.viewport[2]=a;this.viewport[3]=b;this.c.style.width=a+"px";this.c.style.height=b+"px";e.bus&&e.bus.notify("onviewportresize")};f.prototype.move=function(a,b){this.viewport[0]=a;this.viewport[1]=b;e.bus.notify("onviewportmove")};
f.prototype.show=function(a){a!=this.viewport[4]&&(this.c.style.display=a?"block":"none",a&&setTimeout(function(){var a=this.c.getClientRects();this.offsetX=a[0].left;this.offsetY=a[0].top}.bind(this),0));this.viewport[4]=a};
f.prototype.fade=function(a){if(a!=this.viewport[4])if(a){var b=this;(function j(){var a=parseFloat(b.b[0].canvas.style.opacity);isNaN(a)&&(a=0);if(0===a)for(var g=b.b.length;g--;)b.b[g].canvas.style.display="block";if(1<(a+=0.05))e.bus.notify("screenAnimationEnd",{visible:d});else{for(g=b.b.length;g--;)b.b[g].canvas.style.opacity=a;requestAnimationFrame(j)}})()}else b=this,function k(){var a=parseFloat(b.b[0].canvas.style.opacity);isNaN(a)&&(a=1);if(0>(a-=0.05)){for(var h=b.b.length;h--;)b.b[h].canvas.style.display=
"none";e.bus.notify("screenAnimationEnd",{visible:!1})}else{for(h=b.b.length;h--;)b.b[h].canvas.style.opacity=a;requestAnimationFrame(k)}}();this.viewport[4]=a};f.prototype.getLayer=function(a){if(this.b.length>a)return this.b[a]};
f.prototype.addLayer=function(a){a=a||1;for(var b=this.c.innerHTML,c=this.layers;a--;)b+='<canvas style="position:fixed; left: 0px; top: 0px; z-index: '+c+';" id="_tgelr'+c+'"></canvas>',++c;this.c.innerHTML=b;a=c;for(c=0;c<a;++c)this.b[c]=document.getElementById("_tgelr"+c),this.b[c]=this.b[c].getContext("2d");this.layers=a;this.resize(this.viewport[2],this.viewport[3])};
f.prototype.remLayer=function(a){a=a||1;for(var b=this.layers,c=this.c.innerHTML.split("</canvas>"),b=c.length;b--;)0===c[b].length&&(delete c[b],c.splice(b,1));for(b=this.layers;b--;)delete this.b[b];for(b=this.layers;a--;)c.pop(),--b;c=c.join("</canvas>");this.c.innerHTML=c;this.layers=this.b.length=b;for(b=0;b<this.layers;++b)this.b[b]=document.getElementById("_tgelr"+b),this.b[b]=this.b[b].getContext("2d");this.resize(this.viewport[2],this.viewport[3])};
f.prototype.clear=function(a){if(void 0===a)for(a=this.b.length;a--;)this.b[a].clearRect(0,0,this.viewport[2],this.viewport[3]);else(a=this.getLayer(a))&&a.clearRect(0,0,this.viewport[2],this.viewport[3])};f.prototype.setBGColor=function(a){this.c.style.backgroundColor=a};f.prototype.setBoundingBox=function(a,b,c,j){this.d[0]=+a;this.d[1]=+b;this.d[2]=+c;this.d[3]=+j};f.prototype.fullscreen=function(){document.fullscreenEnabled?document.exitFullscreen():this.c.requestFullscreen()};e.ViewPort=f;})(TiledGameEngine);
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(d) {
var c=!0;function f(b,a,e,g){TiledGameEngine.Stage.call(this,"LoadingStage",b,a);this.am=this.am?this.am:new TiledGameEngine.Assets;this.b=g||1;this.c=1;this.a=0;this.g=void 0!==e?e:c;this.status={};this.e=this.e.bind(this);this.f=this.f.bind(this);this.d=c}f.prototype=Object.create(d.Stage.prototype);f.prototype.setStage=function(b){this.c=Math.max(b,this.b);console.log(this.c,b,this.b)};
f.prototype.request=function(b){if(Array.isArray(b))for(var a=b.length;a--;)this.am.request(b[a]),this.status[b[a]]=0;else this.am.request(b),this.status[b]=0};
f.prototype.start=function(){this.status.total=this.am.total();this.am.download(this.e,this.f);this.a=0;for(var b in this.status)"total"!==b&&(this.a+=this.status[b]);this.a=~~(this.a/this.status.total/this.b+(this.c-1)*(100/this.b));this.screen&&(this.screen.clear(),b=this.screen.getLayer(1),b.strokeStyle="rgba(255, 0, 0, 0.5)",b.fillStyle="rgba(255, 0, 0, 0.25)",b.lineWidth=1,b=this.screen.getLayer(2),b.textAlign="center",b.textBaseline="middle",b.fillStyle="rgba(255, 255, 255, 0.75)",this.d=this.redraw=
c,TiledGameEngine.bus.notify("invalidateStage",this.name))};f.prototype.onViewportResize=function(){TiledGameEngine.Stage.prototype.onViewportResize.call(this);var b=this.screen.getLayer(1);b.strokeStyle="rgba(255, 0, 0, 0.5)";b.fillStyle="rgba(255, 0, 0, 0.25)";b.lineWidth=1;b=this.screen.getLayer(2);b.textAlign="center";b.textBaseline="middle";b.fillStyle="rgba(255, 255, 255, 0.75)";this.d=this.redraw=c;TiledGameEngine.bus.notify("invalidateStage",this.name)};f.prototype.onViewportMove=function(){};
f.prototype.e=function(){this.a=~~(100*this.c/this.b);TiledGameEngine.bus.notify("assetsLoaded");this.redraw=c};f.prototype.f=function(b,a){this.a=0;for(var e in this.status)"total"!==e&&(e===b&&(this.status[e]=a),this.a+=this.status[e]);this.a=~~(this.a/this.status.total/this.b+(this.c-1)*(100/this.b));this.redraw=c};
f.prototype.activate=function(){TiledGameEngine.Stage.prototype.activate.call(this);this.i=1;3>this.screen.layers&&this.screen.addLayer(3-this.screen.layers);this.g&&this.start();this.d=c};f.prototype.update=function(){return 100>this.a?(this.redraw=c,500):1E3};
f.prototype.render=function(){this.j=!1;if(this.screen&&this.active){var b=this.screen.viewport,a;this.d&&(a=this.screen.getLayer(0),a.clearRect(0,0,b[2],b[3]),a.save(),a.translate(b[2]/2-93,b[3]/2-125),a.beginPath(),a.moveTo(0,0),a.lineTo(186.25,0),a.lineTo(186.25,250),a.lineTo(0,250),a.closePath(),a.clip(),a.scale(1.25,1.25),a.lineCap="butt",a.lineJoin="miter",a.miterLimit=4,a.save(),a.restore(),a.save(),a.translate(0,200),a.scale(0.1,-0.1),a.save(),a.fillStyle="rgba(29, 57, 101, 1)",a.strokeStyle=
"rgba(29, 57, 101, .75)",a.beginPath(),a.moveTo(1089,1909),a.bezierCurveTo(1070,1882,1062,1879,1030,1882),a.lineTo(992,1885),a.lineTo(981,1835),a.bezierCurveTo(975,1808,968,1776,965,1765),a.bezierCurveTo(960,1748,967,1740,1011,1721),a.bezierCurveTo(1077,1691,1135,1633,1166,1567),a.bezierCurveTo(1201,1490,1199,1473,1148,1459),a.bezierCurveTo(1038,1430,872,1453,745,1517),a.bezierCurveTo(715,1532,675,1543,647,1543),a.lineTo(598,1545),a.lineTo(662,1485),a.bezierCurveTo(738,1413,841,1357,946,1330),a.bezierCurveTo(1076,
1297,1320,1309,1340,1350),a.bezierCurveTo(1344,1358,1352,1378,1356,1394),a.bezierCurveTo(1363,1417,1373,1426,1400,1433),a.bezierCurveTo(1419,1438,1439,1445,1444,1450),a.bezierCurveTo(1449,1455,1447,1488,1440,1527),a.bezierCurveTo(1421,1638,1424,1633,1376,1627),a.bezierCurveTo(1353,1624,1330,1624,1324,1628),a.bezierCurveTo(1312,1636,1230,1756,1230,1765),a.bezierCurveTo(1230,1769,1239,1785,1251,1801),a.bezierCurveTo(1262,1817,1269,1837,1266,1845),a.bezierCurveTo(1260,1862,1142,1940,1123,1940),a.bezierCurveTo(1117,
1940,1101,1926,1089,1909),a.closePath(),a.fill(),a.stroke(),a.restore(),a.save(),a.fillStyle="rgba(236, 143, 41, 1)",a.strokeStyle="rgba(236, 143, 41, 0.75)",a.beginPath(),a.moveTo(197,1677),a.bezierCurveTo(165,1649,140,1618,140,1610),a.bezierCurveTo(140,1602,149,1584,160,1570),a.bezierCurveTo(186,1537,185,1530,151,1462),a.bezierCurveTo(115,1390,99,1376,63,1384),a.bezierCurveTo(48,1387,30,1387,24,1382),a.bezierCurveTo(8,1372,-2,1216,12,1202),a.bezierCurveTo(19,1195,39,1190,57,1190),a.bezierCurveTo(94,
1190,98,1184,129,1092),a.bezierCurveTo(152,1024,148,1E3,110,980),a.bezierCurveTo(84,966,85,948,111,924),a.bezierCurveTo(131,906,132,906,143,925),a.bezierCurveTo(179,991,263,1029,333,1012),a.lineTo(373,1001),a.lineTo(337,1038),a.bezierCurveTo(282,1095,256,1161,256,1250),a.bezierCurveTo(255,1306,261,1337,277,1371),a.bezierCurveTo(300,1422,365,1500,385,1500),a.bezierCurveTo(403,1500,475,1419,498,1373),a.bezierCurveTo(542,1287,555,1222,554,1080),a.bezierCurveTo(553,996,547,917,537,871),a.bezierCurveTo(528,
830,522,795,524,792),a.bezierCurveTo(527,790,542,812,559,842),a.bezierCurveTo(641,983,670,1185,631,1340),a.bezierCurveTo(603,1452,542,1576,479,1644),a.lineTo(429,1699),a.lineTo(389,1685),a.bezierCurveTo(345,1669,327,1674,298,1709),a.bezierCurveTo(288,1721,275,1730,268,1730),a.bezierCurveTo(261,1730,229,1706,197,1677),a.closePath(),a.fill(),a.stroke(),a.restore(),a.save(),a.fillStyle="rgba(78, 126, 40, 1)",a.strokeStyle="rgba(78, 126, 40, 0.75)",a.beginPath(),a.moveTo(1142,1269),a.bezierCurveTo(881,
1225,661,1032,586,781),a.lineTo(570,726),a.lineTo(606,697),a.bezierCurveTo(640,668,641,666,635,615),a.lineTo(628,562),a.lineTo(711,535),a.bezierCurveTo(802,504,795,503,832,570),a.lineTo(850,601),a.lineTo(931,598),a.bezierCurveTo(1011,595,1014,594,1030,565),a.bezierCurveTo(1039,549,1054,534,1062,532),a.bezierCurveTo(1082,528,1220,597,1220,611),a.bezierCurveTo(1220,616,1213,635,1204,651),a.bezierCurveTo(1189,680,1190,683,1214,719),a.bezierCurveTo(1228,739,1255,771,1274,789),a.bezierCurveTo(1306,820,
1311,822,1341,811),a.bezierCurveTo(1358,805,1377,800,1382,800),a.bezierCurveTo(1391,800,1425,870,1418,874),a.bezierCurveTo(1416,875,1395,885,1371,895),a.bezierCurveTo(1319,918,1281,971,1273,1029),a.bezierCurveTo(1269,1058,1263,1070,1251,1070),a.bezierCurveTo(1223,1070,1214,1057,1202,1E3),a.bezierCurveTo(1170,858,1045,757,900,756),a.bezierCurveTo(864,756,818,762,797,769),a.bezierCurveTo(762,781,759,785,765,809),a.bezierCurveTo(777,858,827,955,867,1006),a.bezierCurveTo(944,1102,1087,1192,1247,1246),
a.bezierCurveTo(1290,1260,1327,1274,1329,1276),a.bezierCurveTo(1337,1283,1196,1278,1142,1269),a.closePath(),a.fill(),a.stroke(),a.restore(),a.fillStyle="rgba(29, 57, 101, 1)",a.strokeStyle="rgba(29, 57, 101, 0.75)",a.beginPath(),a.save(),a.rect(20,430,310,-90),a.rect(120,340,110,-240),a.fill(),a.stroke(),a.closePath(),a.restore(),a.save(),a.beginPath(),a.moveTo(580,407),a.bezierCurveTo(530,374,509,331,509,265),a.bezierCurveTo(509,200,532,146,573,116),a.bezierCurveTo(614,86,749,86,800,116),a.bezierCurveTo(835,
136,835,137,838,213),a.lineTo(841,290),a.lineTo(760,290),a.lineTo(680,290),a.lineTo(680,250),a.bezierCurveTo(680,211,681,210,715,210),a.bezierCurveTo(756,210,760,198,725,182),a.bezierCurveTo(688,165,663,167,640,190),a.bezierCurveTo(615,215,613,295,636,328),a.bezierCurveTo(654,354,696,357,721,334),a.bezierCurveTo(735,321,750,319,789,325),a.bezierCurveTo(851,333,854,348,806,396),a.bezierCurveTo(773,429,770,430,692,430),a.bezierCurveTo(627,430,607,426,580,407),a.closePath(),a.fill(),a.stroke(),a.restore(),
a.save(),a.beginPath(),a.moveTo(1050,265),a.lineTo(1050,100),a.lineTo(1190,100),a.lineTo(1330,100),a.lineTo(1330,140),a.lineTo(1330,180),a.lineTo(1240,180),a.bezierCurveTo(1151,180,1150,180,1150,205),a.bezierCurveTo(1150,230,1151,230,1230,230),a.lineTo(1310,230),a.lineTo(1310,270),a.lineTo(1310,310),a.lineTo(1230,310),a.bezierCurveTo(1157,310,1150,312,1150,330),a.bezierCurveTo(1150,348,1157,350,1235,350),a.lineTo(1320,350),a.lineTo(1320,390),a.lineTo(1320,430),a.lineTo(1185,430),a.lineTo(1050,430),
a.lineTo(1050,265),a.closePath(),a.fill(),a.stroke(),a.restore(),a.rect(360,100,100,90),a.rect(890,100,100,90),a.rect(1370,100,100,90),a.fill(),a.stroke(),a.restore(),a.restore(),a=this.screen.getLayer(1),a.clearRect(b[2]/2-90,b[3]/2+130,180,20,20),a.roundRect(b[2]/2-90,b[3]/2+130,180,20,20).stroke());a=this.screen.getLayer(2);a.clearRect(b[2]/2-90,b[3]/2+130,180,20,20);a.strokeStyle="rgba(255, 0, 0, 0.5)";a.fillStyle="rgba(255, 0, 0, 0.25)";a.lineWidth=1;a.roundRect(b[2]/2-90,b[3]/2+130,180*this.a/100,20,20).fill();
a.textAlign="center";a.textBaseline="middle";a.fillStyle="rgba(255, 255, 255, 0.75)";a.fillText(this.a+"% Loaded",b[2]/2,b[3]/2+140,140);this.d=!1}};d.LoadingStage=f;
})(TiledGameEngine);
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(g){function t(b,e){this.asset=e;this.assetsManager=b;this.ready=!1;this.layers=[];this.entitiesLayer=this.layerscnt=0;this.tilesets=[];this.tilewidth=64;this.tileheight=32;this.bgcolor="#000";this.objects=[]}
t.prototype.parse=function(){if(this.ready)return g.bus.notify("tmxMapParsed"),!0;if(!this.assetsManager)return!1;var b=this.assetsManager.get(this.asset),e,a,d,c,k,n,u,h,r,s,f,p,v,w,l,j,m=0;if(!b)return!1;e=b.tilesets;for(d=e.length;d--;)a=e[d],a.rows=~~(a.imageheight/a.tileheight),a.cols=~~(a.imagewidth/a.tilewidth),a.lastgid=~~(a.firstgid+a.rows*a.cols)-1,delete a.imageheight,delete a.imagewidth;b.tilesets=e;g.bus.notify("tmxMapParseProgress",1);e=b.layers;n=e.length;d=0;for(var q=[];d<n;++d)if(a=
e[d],"tilelayer"===a.type){a.data=new Uint16Array(a.data);a.screen=new Int16Array(5*a.data.length);if(a.properties){if(a.properties.render&&("0"===a.properties.render||"false"===a.properties.render)){a.properties.render=0;a.visible=0;continue}if(a.properties.mergeWithLayer)if(a.properties.mergeWithLayer===a.name)a.ctxlayer=m++;else for(c=0;c<n;c++){if(e[c].name===a.properties.mergeWithLayer){a.ctxlayer=c;break}}else a.ctxlayer=m++}else a.properties={},a.ctxlayer=m++;a.properties.render=1;a.tilewidth=
b.tilewidth;a.tileheight=b.tileheight;u=a.data;k=u.length;for(c=0;c<k;++c)if(h=u[c]){for(p=b.tilesets.length;p--&&!(f=b.tilesets[p],h>=f.firstgid&&h<=f.lastgid););0>p?a.visible=0:(f.tilewidth>a.tilewidth&&(a.tilewidth=f.tilewidth),f.tileheight>a.tileheight&&(a.tileheight=f.tileheight),h-=f.firstgid,v=~~(h%f.cols)*f.tilewidth,w=~~(h/f.cols)*f.tileheight,r=~~(c%a.width),s=~~(c/a.width),l=(r-s)*b.tilewidth/2,j=(r+s)*b.tileheight/2,f.tileoffset&&(l+=f.tileoffset.x,j+=f.tileoffset.y),j-=f.tileheight,j+=
b.tileheight,l-=b.tilewidth/2,a.screen[5*c+0]=p,a.screen[5*c+1]=v,a.screen[5*c+2]=w,a.screen[5*c+3]=l,a.screen[5*c+4]=j,f.tiles&&f.tiles[h]&&(q[q.length]={type:"tile",layer:d,id:c,x:r,y:s}))}}b.layers=e;g.bus.notify("tmxMapParseProgress",2);this.layers=b.layers;this.tilesets=b.tilesets;this.tilewidth=+b.tilewidth;this.tileheight=+b.tileheight;this.mapwidth=this.tilewidth*b.width;this.mapheight=this.tileheight*b.height;this.bgcolor=b.backgroundcolor;this.layerscnt=m;this.width=+b.width;this.height=
+b.height;g.bus.notify("tmxMapParseProgress",3);if(0<q.length){d=0;for(n=q.length;d<n;++d)(b=g.EntitiesFactory.create(q[d],this.assetsManager,this))&&(this.objects[this.objects.length]=b);this.entitiesLayer=m++;this.layerscnt=m}g.bus.notify("tmxMapParseProgress",4);this.objects=this.objects.sort(function(a,b){return a.z-b.z});g.bus.notify("tmxMapParseProgress",5);this.ready=1;g.bus.notify("tmxMapParsed");return!0};
t.prototype.getAssets=function(){var b=this.assetsManager.get(this.asset);if(!b)return[];for(var e=b.tilesets,a=[],d,c=e.length;c--;)d=e[c],d.properties.download&&("false"===d.properties.download||"0"===d.properties.download)?(delete e[c],e.splice(c,1),++c):a[a.length]=d.image;b.tilesets=e;for(var k,c=b.layers.length;c--;)if(e=b.layers[c],"objectgroup"===e.type)for(k=e.objects.length;k--;)d=e.objects[k],"unit"===d.type&&(d.properties&&d.properties.img&&d.properties.inf)&&(a[a.length]=d.properties.img,
a[a.length]=d.properties.inf);return a};g.TiledMap=t;})(TiledGameEngine);
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(m){var j=!0,l=!1;function s(b,a,d){TiledGameEngine.Stage.call(this,"TiledMapStage",b,a);this.a=d;this.b=[];this.d=l;this.f=[];this.n=this.m=0;this.g=j;this.o=this.p=this.l=this.k=0;this.c=l;this.e=j}var t=new Int32Array(2);new Int32Array(2);s.prototype=Object.create(m.Stage.prototype);
s.prototype.activate=function(){TiledGameEngine.Stage.prototype.activate.call(this);this.screen.layers<this.a.layerscnt?this.screen.addLayer(this.a.layerscnt-this.screen.layers):this.screen.layers>this.a.layerscnt&&this.screen.remLayer(this.screen.layers-this.a.layerscnt);this.screen.clear();this.screen.setBGColor(this.a.bgcolor);this.redraw=j;this.a&&(this.f=[~~(-this.a.mapwidth/2+this.screen.viewport[2]/2),0],this.screen.move(this.f[0],this.f[1]),this.screen.setBoundingBox(-(this.a.mapwidth-this.screen.viewport[2]),
-(this.a.mapheight-this.screen.viewport[3]),this.a.mapwidth-this.screen.viewport[2],this.a.mapheight-this.screen.viewport[3]));this.screen.fade(j)};s.prototype.onViewportResize=function(b,a){TiledGameEngine.Stage.prototype.onViewportResize.call(this,b,a);this.d=l;this.e=this.c=j};s.prototype.onViewportMove=function(b,a){TiledGameEngine.Stage.prototype.onViewportMove.call(this,b,a);this.d=l;this.c=j};
s.prototype.j=function(b,a){b=(b-this.screen.viewport[0]-this.a.mapwidth/2)/this.a.tilewidth;a=(a-this.screen.viewport[1])/this.a.tileheight;t[0]=~~(b+a);t[1]=~~(a-b);return t};s.prototype.update=function(b,a){if(!this.screen||!this.a||!this.active)return 500;if(!this.a.ready)return 100;this.redraw=l;var d,c=this.a.objects.length;if(!c||!this.g)return~~(16-b%16);d=1E3;for(var f=0;f<c;++f){var k=this.a.objects[f];d=Math.min(d,k.update(b,a,this.screen.viewport));this.redraw|=k.redraw}return d};
s.prototype.render=function(){if(this.active&&(this.a&&this.screen)&&this.a.ready){var b=this.screen.viewport;if(!this.d||this.c||this.e)this.h(),this.d=j;this.redraw=l;var a=this.a.layers.length,d=0,c,f;if(this.c)for(this.screen.clear();d<a;++d)c=this.a.layers[d],"tilelayer"===c.type&&(c.visible&&c.properties.render&&!c.properties.mergeWithLayer)&&(f=this.screen.getLayer(c.ctxlayer),f.drawImage(this.b[c.ctxlayer],0,0));this.e=this.c=l;if(f=this.screen.getLayer(this.a.entitiesLayer)){f.clearRect(0,
0,b[2],b[3]);d=0;for(a=this.a.objects.length;d<a;++d)c=this.a.objects[d],c.visible&&c.render(f,this,b)}}};
s.prototype.i=function(b,a,d,c,f,k,n,q){var e=this.a.layers[a];a=e.data;var r=e.screen,p,w=-f;p=-k;var h,g,u,v=this.screen.viewport;if("tilelayer"!==e.type)console.log("ignore (type)",e.name);else if(e.visible)if(e.properties.render)for(;p<=k;p++)for(e=w;e<=f;e++){if(!(e+p&1)&&(h=d+~~((p+e)/2),g=c+~~((p-e)/2),!(0>h||0>g)))if(!(h>=n||g>=q))if(h+=g*n,g=a[h])g=r[5*h+0],0>g||(g=this.a.tilesets[g],(u=this.am.get(g.image))&&b.drawImage(u,r[5*h+1],r[5*h+2],g.tilewidth,g.tileheight,r[5*h+3]+this.a.mapwidth/
2+v[0],r[5*h+4]+v[1],g.tilewidth,g.tileheight))}else console.log("ignore (render)",e.name);else console.log("ignore (visible)",e.name)};
s.prototype.h=function(){var b=0,a,d=this.a.layers.length,c;a=this.screen.viewport;for(var f=this.j(a[2]/2,a[3]/2),k=~~(a[2]/this.a.tilewidth)+2,n=~~(a[3]/this.a.tileheight)+2,q=a[2],e=a[3],k=k>this.a.width?this.a.width:k,n=n>this.a.height?this.a.height:n;b<d;++b)a=this.a.layers[b],"tilelayer"===a.type&&(a.visible&&a.properties.render)&&(this.b[a.ctxlayer]?(c=this.b[a.ctxlayer].getContext("2d"),a.properties.mergeWithLayer||(this.e?(this.b[a.ctxlayer].width=q,this.b[a.ctxlayer].height=e):c.clearRect(0,
0,q,e))):(this.b[a.ctxlayer]=document.createElement("canvas"),this.b[a.ctxlayer].width=q,this.b[a.ctxlayer].height=e,c=this.b[a.ctxlayer].getContext("2d")),this.i(c,b,f[0],f[1],k,n,this.a.width,this.a.height));this.k=this.screen.viewport[0];this.l=this.screen.viewport[1]};m.TiledMapStage=s})(TiledGameEngine);
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(c){function d(){}d.prototype.register=function(b,a){this[b.toLowerCase()]=a};d.prototype.create=function(b){if(b.type){var a=b.type.toLowerCase();if(this[a])return a=new this[a],a.init.apply(a,arguments),a;if(this.entity)return a=new this.entity,a.init.apply(a,arguments),a}};c.EntitiesFactory=new d})(TiledGameEngine);
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(a){function d(){this.map=this.am=void 0;this.x=this.y=this.z=0;this.name="";this.img=void 0;this.redraw=!1}d.prototype.init=function(b,e,c){this.am=e;this.map=c;this.x=b.x||0;this.y=b.y||0;this.z=this.x+20*this.y*c.width;this.name=b.name;this._data=b;this.redraw=this.visible=!0};d.prototype.update=function(){return 1E3};d.prototype.render=function(){this.redraw&&(this.visible&&this.img)&&(this.redraw=!1)};a.EntitiesFactory.register("Entity",d)})(TiledGameEngine);
/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(f){var e=!1;function m(){TiledGameEngine.EntitiesFactory.entity.call(this);this.height=this.width=void 0;this.c=e;this.b=void 0;this.frames=1;this.frame=0;this.id=this.d=void 0;this.a=0}m.prototype=Object.create(TiledGameEngine.EntitiesFactory.entity.prototype);
m.prototype.init=function(a,d,c){TiledGameEngine.EntitiesFactory.entity.prototype.init.call(this,a,d,c);var g=c.layers[a.layer].screen,b=c.tilesets[g[5*a.id]];this.d=a.layer;this.id=a.id;this.width=b.tilewidth;this.height=b.tileheight;this.z-=~~(this.height/c.tileheight);if(b.tiles&&(a=c.layers[a.layer].data[a.id]-b.firstgid,b.tiles[a])){this.c=!0;b.tileproperties&&b.tileproperties[a]&&(b.tileproperties[a].animated&&(this.c="false"===b.tileproperties[a].animated||0===b.tileproperties[a].animated?
e:!0),this.frame=+b.tileproperties[a].startframe||0);for(var j=b.tiles[a].animation,k=j.length,h=0,l=[];h<k;++h)a=j[h].tileid,l[h]=new Uint32Array([~~(a%b.cols)*b.tilewidth,~~(a/b.cols)*b.tileheight,+j[h].duration]);this.b=l;this.frames=k;this.frame%=k}this.b||(this.frames=1,this.frame=0,this.c=e,this.b=[new Uint32Array([g[5*this.id+1],g[5*this.id+2],1E3])]);this.x=g[5*this.id+3]+~~(c.mapwidth/2);this.y=g[5*this.id+4];this.img=d.get(b.image)};
m.prototype.update=function(a,d,c){this.width||console.error("tile is not loaded");this.visible=0<this.x+this.width+c[0]&&0<this.y+this.height+c[1]&&this.x+c[0]<c[2]&&this.y+c[1]<c[3]?!0:e;this.redraw=e;if(this.c&&this.visible){if(d>=this.a){this.a||(this.a=d);for(;d>=this.a;)this.a+=this.b[this.frame][2],this.frame=(this.frame+1)%this.frames;this.redraw=!0}return this.a-d}return 1E3};
m.prototype.render=function(a,d,c){this.visible&&this.img&&(d=this.b[this.frame],a.drawImage(this.img,d[0],d[1],this.width,this.height,this.x+c[0],this.y+c[1],this.width,this.height),this.redraw=e)};f.EntitiesFactory.register("tile",m)})(TiledGameEngine);