/*! TiledGameEngine v1.0.0 - 20th Feb 2015 | https://github.com/elvariongh/tiledgameengine */
(function(k,h){function b(){this.e=this.f=0;this.c={};this.b=[];this.k={};this.d=this.a=void 0;this.j=this.j.bind(this);this.g=this.g.bind(this);this.i=this.i.bind(this)}b.prototype.j=function(a){a.lengthComputable?a.loaded!==a.total&&this.a&&this.a(a.target.url,~~(a.loaded/a.total*100)):this.a&&this.a(a.target.url,-1)};b.prototype.g=function(){++this.e;this.completed()&&this.h()};b.prototype.l=function(a,f){var b=new Blob([a],{type:f}),c=new Image;c.onload=function(){window.URL.revokeObjectURL(c.src)};c.src=window.URL.createObjectURL(b);return c};b.prototype.m=function(a){a=new Uint8Array(a);for(var f=a.length,b="",c=0;c<f;c+=65535){var d=65535;c+65535>f&&(d=f-c);b+=String.fromCharCode.apply(null,a.subarray(c,c+d))}return JSON.parse(b)};b.prototype.i=function(a){a=a.target;var b=a.getResponseHeader("content-type");-1!==b.indexOf("image")?(b=this.l(a.response,b),this.f++):-1!==b.indexOf("json")?(b=this.m(a.response),this.f++):(console.warn("Unknown asset type",b),b=a.response,++this.e);this.c[a.url]=b;this.a&&this.a(a.url,100);this.completed()&&this.h()};b.prototype.h=function(){var a=this.d;this.d=this.a=void 0;this.b.length=0;a&&a()};b.prototype.request=function(a){this.k[a]||(this.b[this.b.length]=a,this.k[a]=1)};b.prototype.download=function(a,b){if(0===this.b.length)a&&a();else{this.d=a;this.a=b;for(var g=0,c=this.b.length;g<c;++g){var d=this.b[g];if(this.c[d]){if(this.a&&this.a(d,100),this.completed()){this.h();break}}else{var e=new XMLHttpRequest;e.open("GET",d,!0);e.responseType="arraybuffer";e.url=d;e.onprogress=this.j;e.onerror=this.g;e.onload=this.i;e.send()}}}};b.prototype.get=function(a){return this.c[a]};b.prototype.clear=function(){this.e=this.f=0;this.c={};this.b.length=0;this.k={};this.d=this.a=void 0};b.prototype.completed=function(){return this.b.length<=this.e+this.f};b.prototype.total=function(){return this.b.length};h.Assets=b})(window,TiledGameEngine);