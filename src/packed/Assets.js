/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(h,j){var d=void 0;function k(){this.c=this.f=0;this.d={};this.b=[];this.k={};this.e=this.a=d;this.j=this.j.bind(this);this.g=this.g.bind(this);this.i=this.i.bind(this)}k.prototype.j=function(a){a.lengthComputable?a.loaded!==a.total&&this.a&&this.a(a.target.url,~~(100*(a.loaded/a.total))):this.a&&this.a(a.target.url,-1)};k.prototype.g=function(){++this.c;this.completed()&&this.h()};
k.prototype.l=function(a,b){var e=new Blob([a],{type:b}),c=new Image;c.onload=function(){h.URL.revokeObjectURL(c.src)};c.src=h.URL.createObjectURL(e);return c};k.prototype.m=function(a){a=new Uint8Array(a);for(var b=a.length,e="",c=0;c<b;c+=65535){var f=65535;c+65535>b&&(f=b-c);e+=String.fromCharCode.apply(null,a.subarray(c,c+f))}return JSON.parse(e)};
k.prototype.i=function(a){a=a.target;if(404!==a.status){var b=a.getResponseHeader("content-type");-1!==b.indexOf("image")?(b=this.l(a.response,b),this.f++):-1!==b.indexOf("json")?(b=this.m(a.response),this.f++):(console.warn("Unknown asset type",b),b=a.response,++this.c);this.d[a.url]=b}else++this.c,console.warn("Asset not found (404)",a.url);this.a&&this.a(a.url,100);this.completed()&&this.h()};k.prototype.h=function(){var a=this.e;this.e=this.a=d;this.b.length=0;a&&a()};
k.prototype.request=function(a){this.k[a]||(this.b[this.b.length]=a,this.k[a]=1)};k.prototype.download=function(a,b){if(0===this.b.length)a&&a();else{this.e=a;this.a=b;for(var e=0,c=this.b.length;e<c;++e){var f=this.b[e];if(this.d[f]){if(this.a&&this.a(f,100),this.completed()){this.h();break}}else{var g=new XMLHttpRequest;g.open("GET",f,!0);g.responseType="arraybuffer";g.url=f;g.onprogress=this.j;g.onerror=this.g;g.onload=this.i;g.send()}}}};k.prototype.get=function(a){return this.d[a]};
k.prototype.clear=function(){this.c=this.f=0;this.d={};this.b.length=0;this.k={};this.e=this.a=d};k.prototype.completed=function(){return this.b.length<=this.c+this.f};k.prototype.total=function(){return this.b.length};j.Assets=k;})(window,TiledGameEngine);