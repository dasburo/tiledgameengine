/*! TiledGameEngine v0.0.1 - 10th Mar 2015 | https://github.com/elvariongh/tiledgameengine */
(function(f){var e=!1;function m(){TiledGameEngine.EntitiesFactory.entity.call(this);this.height=this.width=void 0;this.c=e;this.b=void 0;this.frames=1;this.frame=0;this.id=this.d=void 0;this.a=0}m.prototype=Object.create(TiledGameEngine.EntitiesFactory.entity.prototype);
m.prototype.init=function(a,d,c){TiledGameEngine.EntitiesFactory.entity.prototype.init.call(this,a,d,c);var g=c.layers[a.layer].screen,b=c.tilesets[g[5*a.id]];this.d=a.layer;this.id=a.id;this.width=b.tilewidth;this.height=b.tileheight;this.z-=~~(this.height/c.tileheight);if(b.tiles&&(a=c.layers[a.layer].data[a.id]-b.firstgid,b.tiles[a])){this.c=!0;b.tileproperties&&b.tileproperties[a]&&(b.tileproperties[a].animated&&(this.c="false"===b.tileproperties[a].animated||0===b.tileproperties[a].animated?
e:!0),this.frame=+b.tileproperties[a].startframe||0);for(var j=b.tiles[a].animation,k=j.length,h=0,l=[];h<k;++h)a=j[h].tileid,l[h]=new Uint32Array([~~(a%b.cols)*b.tilewidth,~~(a/b.cols)*b.tileheight,+j[h].duration]);this.b=l;this.frames=k;this.frame%=k}this.b||(this.frames=1,this.frame=0,this.c=e,this.b=[new Uint32Array([g[5*this.id+1],g[5*this.id+2],1E3])]);this.x=g[5*this.id+3]+~~(c.mapwidth/2);this.y=g[5*this.id+4];this.img=d.get(b.image)};
m.prototype.update=function(a,d,c){this.width||console.error("tile is not loaded");this.visible=0<this.x+this.width+c[0]&&0<this.y+this.height+c[1]&&this.x+c[0]<c[2]&&this.y+c[1]<c[3]?!0:e;this.redraw=e;if(this.c&&this.visible){if(d>=this.a){this.a||(this.a=d);for(;d>=this.a;)this.a+=this.b[this.frame][2],this.frame=(this.frame+1)%this.frames;this.redraw=!0}return this.a-d}return 1E3};
m.prototype.render=function(a,d,c){this.visible&&this.img&&(d=this.b[this.frame],a.drawImage(this.img,d[0],d[1],this.width,this.height,this.x+c[0],this.y+c[1],this.width,this.height),this.redraw=e)};f.EntitiesFactory.register("tile",m)})(TiledGameEngine);